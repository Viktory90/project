<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Xin nghỉ phép</title>
	<meta name="description" content=" and Validation" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<!-- basic styles -->
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet" />

	<link rel="stylesheet" href="assets/css/font-awesome.min.css" />
	<!--[if IE 7]>
	  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
	<![endif]-->


	<!-- page specific plugin styles -->
		
		<link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.custom.min.css" />
		<link rel="stylesheet" href="assets/css/chosen.css" />
		<link rel="stylesheet" href="assets/css/datepicker.css" />
		<link rel="stylesheet" href="assets/css/bootstrap-timepicker.css" />
		<link rel="stylesheet" href="assets/css/daterangepicker.css" />
		<link rel="stylesheet" href="assets/css/colorpicker.css" />

	<!-- ace styles -->
	<link rel="stylesheet" href="assets/css/ace.min.css" />
	<link rel="stylesheet" href="assets/css/ace-responsive.min.css" />
	<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
	<link rel="stylesheet" href="assets/css/custom/loading.css">
	
	<!--[if lt IE 9]>
	  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
	<![endif]-->

</head>
<body>
	<span id="navbar"> </span>
	<div class="main-container container-fluid">
		
		<div class="main-container-inner">
			<div class="sidebar" id="sidebar">
			</div>
			<div class="main-content">
				<div class="page-content">	
					<div class="page-header">					
						<h1><span id="createNewCustomer_page-header">NVBH</span>
						<small>
							<i class="icon-double-angle-right"></i>
							<span id="createNewCustomer_title">Xin nghỉ phép</span>
						</small>
						</h1>
					</div>
					<div class="row-fluid">	
						<div class="row-fluid">
							<div class="span12">
								<div id="loading">								
									<i class="icon-spinner icon-spin orange bigger-250" id="loading_image"></i>														
								</div>
								<div class="widget-box">
									<div class="widget-header widget-header-blue widget-header-flat wi1dget-header-large">
										<h4 class="lighter">Gửi đơn xin nghỉ phép</h4>								
									</div>
									<div class="widget-body">
			 							<div class="widget-main">
			 								<div class="row-fluid">
			 									<form id="employeeLeave-form" class="form-horizontal">
													<div class="control-group">
														<label class="control-label" for="leaveTypeId">
															Kiểu nghỉ phép(*)
														</label>
														<div class="controls">
															<div class="span12">
																<select name="leaveTypeId" id="leaveTypeId">
																</select>
																
															</div>
														</div>
													</div>
													<div class="control-group">
														<label class="control-label" for="fromDate">
															Từ ngày(*)
														</label>
														<div class="controls">
															<div class="row-fluid span6 input-append date">
																<input class="span6 date-picker" id="fromDate" name="fromDate" type="text" data-date-format="dd-mm-yyyy" />
																<span class="add-on"><i class="icon-calendar"></i></span>
															</div>
														</div>
													</div>
													<div class="control-group">
														<label class="control-label" for="emplLeaveReasonTypeId">
															Lý do xin nghỉ
														</label>
														<div class="controls">
															<div class="span12">
																<select name="emplLeaveReasonTypeId" id="emplLeaveReasonTypeId">
																	
																</select>
																
															</div>
														</div>
													</div>
													<div class="control-group">
														<label class="control-label" for="thruDate">
															Đến ngày(*)
														</label>
														<div class="controls">
															<div class="row-fluid span6 input-append date">
																<input class="span6 date-picker" name="thruDate" id="thruDate" type="text" data-date-format="dd-mm-yyyy" />
																<span class="add-on"><i class="icon-calendar"></i></span>
																
															</div>
														</div>
													</div>
													<div class="control-group">
														<label class="control-label" for="description">
															Ghi chú
														</label>
														<div class="controls">
															<div class="span12 row-fluid">
																<input  type="text" id="description" name="description" />
															</div>
														</div>
													</div>
			 									</form>
			 								</div>
			 								<div class="form-actions">
												<button class="btn btn-info btn-small" id="send_employeeLeave"><i class="icon-ok"></i>
													<span id="">Gửi</span>
												</button>
												<button class="btn btn-danger btn-small" onclick="location = 'empLeaveReport.html'"><i class="icon-eye"></i>
													<span id="">Xem lịch sử nghỉ phép</span>
												</button>
											</div>
			 							</div>
			 						</div>		
								</div>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- basic scripts -->
		<script type="text/javascript">
		window.jQuery
				|| document
						.write("<script src='assets/js/jquery-2.0.3.min.js'>"
								+ "<"+"/script>");
		</script>
		
		<script src="assets/js/bootstrap.min.js"></script>

		<!-- page specific plugin scripts -->
		
		<!-- <script type="text/javascript" src="assets/js/fuelux.wizard.js"></script> -->

		<script type="text/javascript" src="assets/js/jquery.validate.min.js"></script>

		<script type="text/javascript" src="assets/js/bootbox.min.js"></script>

		<script type="text/javascript" src="assets/js/jquery.maskedinput.min.js"></script>

		<script type="text/javascript" src="assets/js/chosen.jquery.min.js"></script>
		
		<script type="text/javascript" src="assets/js/date-time/bootstrap-datepicker.min.js"></script>

		<script type="text/javascript" src="assets/js/date-time/bootstrap-timepicker.min.js"></script>

		<script type="text/javascript" src="assets/js/date.js"></script>

		<script type="text/javascript" src="assets/js/date-time/daterangepicker.min.js"></script>
		
		
		<!-- ace scripts -->
		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>
		<!-- inline scripts related to this page -->
		<script type="text/javascript">
		jQuery(function($){
			$.get("header.html", function(data) {
				$('#navbar').html(data);
			}, 'html').fail(function() {
				console.log('arge', arguments)
			});
			$('.date-picker').datepicker();
			$("#loading").hide();
			$.ajax({
				url: localStorage.serverUrl + 'mobileservices/control/employeeLeaveType',
				crossDomain: true,
				dataType: 'json',
				type: 'POST',
				success: function(data){
					fillLeaveTypeId(data);
				},
				error: function(){
					
				}
			});
			$.ajax({
				url: localStorage.serverUrl + 'mobileservices/control/employeeLeaveReason',
				crossDomain: true,
				dataType: 'json',
				type: 'POST',
				success: function(data){
					fillLeaveTypeReason(data);
				},
				error: function(){
					
				}
			});
			var employeeLeave_validate = $('#employeeLeave-form').validate({
				errorElement: 'span',
				errorClass: 'help-inline',
				focusInvalid: false,
				errorPlacement: function(error, element) {
					//element.html("");
					//console.log(element);
					error.appendTo(".error");
				 },
				rules: {					
					leaveTypeId: {
						required: true
					},
					fromDate: {
						required: true						
					},
					thruDate: {
						required: true						
					}
				},

				messages: {
					leaveTypeId: {
						required: "Chọn kiểu nghỉ phép"						
					},
					fromDate: {
						required: "Chọn ngày bắt đầu nghỉ phép!"						
					},
					thruDate: {
						required: "Chọn ngày kết thúc nghỉ phép!"
					}
				},

				/* invalidHandler: function (event, validator) { //display error alert on form submit   
					$('.alert-error', $('.login-form')).show();
					console.log(event);
					console.log(validator);
				}, */

				highlight: function (e) {
					$(e).closest('.control-group').removeClass('info').addClass('error');
				},

				success: function (e) {
					$(e).closest('.control-group').removeClass('error').addClass('info');
					$(e).remove();
					//console.log(Date.parseDate($("#fromDate").val(), "dd-mm-yyyy"));
				},

				errorPlacement: function (error, element) {
					//console.log(element.next());
					if(element.is(':checkbox') || element.is(':radio')) {
						var controls = element.closest('.controls');
						if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
						else error.insertAfter(element.nextAll('.lbl').eq(0));
					} 
					else if(element.is('.chzn-select')) {
						error.insertAfter(element.nextAll('[class*="chzn-container"]').eq(0));
					}
					else if(element.next().hasClass("add-on")){
						error.insertAfter(element.next());
					}
					else error.insertAfter(element);
				},

				submitHandler: function (form) {
					alert("submit");
				},
				invalidHandler: function (form, validator) {
					//alert("invalid");
					//console.log(validator);
				}
			});
			
			$("#send_employeeLeave").click(function(){
				if($("#employeeLeave-form").valid()){
					$("#loading").show();
					$.ajax({
						url: localStorage.serverUrl + 'mobileservices/control/createEmplLeave',
						crossDomain: true,
						data:{
							leaveTypeId: $("#leaveTypeId").val(),
							fromDate: $("#fromDate").val(),
							thruDate: $("#thruDate").val(),
							emplLeaveReasonTypeId: $("#emplLeaveReasonTypeId").val()
						},
						type: 'POST',
						dataType: 'json',
						success: function(data){
							if(data._EVENT_MESSAGE_){	
								if(data._EVENT_MESSAGE_.indexOf("Create successfully!") > -1){
									bootbox.dialog("Đã gửi đơn xin nghỉ phép!!", 
											[{
												"label":"Xem lịch sử nghỉ phép",
												"class": "btn-small btn-primary",
												"callback": function(){
													location = "empLeaveReport.html";
												}
											},
											{
												"label":"Đóng",
												"class": "btn-small btn-danger"
											}]);
								}else if(data._EVENT_MESSAGE_.indexOf("Duplicate_entry") > -1){
									bootbox.dialog("Đơn nghỉ phép trùng với đơn khác đã tạo!!", 
											[{
												"label":"Xem lịch sử nghỉ phép",
												"class": "btn-small btn-primary",
												"callback": function(){
													location = "empLeaveReport.html";
												}
											},
											{
												"label":"Đóng",
												"class": "btn-small btn-danger"
											}]);
								}else{
									bootbox.dialog("Đơn xin nghỉ phép lỗi! Hãy xem lại ngày bắt đầu nghỉ phép hoặc kiểu nghỉ phép", 
											[{
												"label":"Đóng",
												"class": "btn-small btn-danger"
											},
											{
												"label":"Xem lịch sử nghỉ phép",
												"class": "btn-small btn-danger",
												"callback": function(){
													location = "empLeaveReport.html";
												}
											}]);
								}
							}else{
								bootbox.dialog("Đã xảy ra lỗi! Hãy xem lại ngày bắt đầu nghỉ phép hoặc kiểu nghỉ phép!!", 
										[{
											"label":"Xem lịch sử nghỉ phép",
											"class": "btn-small btn-primary",
											"callback": function(){
												location = "empLeaveReport.html";
											}
										},
										{
											"label":"Đóng",
											"class": "btn-small btn-danger"
										}]);
							}
							
						},
						error: function(textStatus, errorThrown){
							
						},
						complete: function(jqXHR, textStatus){
							$("#loading").hide();
						}
					});
				}
			});
			
			
		});
		
		function fillLeaveTypeId(data){
			leaveTypeId = data.leaveType;
			
			for(var index in leaveTypeId){
				$("#leaveTypeId").append(new Option(leaveTypeId[index].description, leaveTypeId[index].leaveTypeId));
			}
		}
		function fillLeaveTypeReason(data){
			leaveTypeReason = data.leaveTypeReason;
			$("#emplLeaveReasonTypeId").append(new Option("", ""));
			for(var index in leaveTypeReason){
				$("#emplLeaveReasonTypeId").append(new Option(leaveTypeReason[index].emplLeaveReasonTypeId,leaveTypeReason[index].emplLeaveReasonTypeId));
			}
		}
		</script>					
</body>
</html>