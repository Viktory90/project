<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>User Profile Page - Ace Admin</title>

<meta name="description" content="3 styles with inline editable feature" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- basic styles -->

<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
<link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet" />
<link rel="stylesheet" href="assets/css/font-awesome.min.css" />

<!--[if IE 7]>
		  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

<!-- page specific plugin styles -->

<!-- <link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.full.min.css" />-->
		
<link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.custom.min.css" />
<link rel="stylesheet" href="assets/css/chosen.css" />
<link rel="stylesheet" href="assets/css/jquery.gritter.css" />
<link rel="stylesheet" href="assets/css/select2.css" />
<link rel="stylesheet" href="assets/css/bootstrap-editable.css" />


<!-- fonts -->

<link rel="stylesheet" href="assets/css/ace-fonts.css" />

<!-- ace styles -->

<link rel="stylesheet" href="assets/css/ace.min.css" />
<link rel="stylesheet" href="assets/css/ace-responsive.min.css" />
<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
<link rel="stylesheet" href="assets/css/custom/loading.css">

<!--[if lte IE 8]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

<!-- inline styles related to this page -->

<!-- ace settings handler -->
<style type="text/css">
	form#editName label.error{
		color: red;
	}
	</style>
<script src="assets/js/ace-extra.min.js"></script>
</head>

<body>
	<div class="navbar" id="navbar">
		<!-- /.navbar-inner -->
	</div>

	<div class="main-container container-fluid">
		<div id="test">
			
		</div>
		<div class="main-content">
			<div class="page-content">
				
				<div class="page-header position-relative">
					<h1>
						Trang cá nhân salesman
						
					</h1>
				</div>
				<!-- /.page-header -->

				<div class="row-fluid">
					<div class="span12">
						<!-- PAGE CONTENT BEGINS -->

						<div class="clearfix">
						<div id="loading">								
									<i class="icon-spinner icon-spin orange bigger-250" id="loading_image"></i>														
							</div>

							<div class="pull-right">
								<span class="green middle bolder">Chọn: &nbsp;</span>

								<div class="btn-toolbar inline middle no-margin">
									<div data-toggle="buttons-radio" class="btn-group no-margin">
										<button class="btn btn-small btn-yellow active">
											<span class="bigger-110">1</span>
										</button>

										<button class="btn btn-small btn-yellow">
											<span class="bigger-110">2</span>
										</button>

										<!-- <button class="btn btn-small btn-yellow">
											<span class="bigger-110">3</span>
										</button> -->
									</div>
								</div>
							</div>
						</div>

						<div class="hr dotted"></div>						
						
						<div>
							<div id="user-profile-1" class="user-profile row-fluid">
								<div class="span3 center">
									<div>
										<span class="profile-picture"> 
											<img id="avatar" class="editable" alt="avatar" src="assets/avatars/profile-pic.jpg" />
										</span>

										<div class="space-4"></div>

										<div
											class="width-80 label label-info label-large arrowed-in arrowed-in-right">
											<div class="inline position-relative">
												<a href="#" class="user-title-label dropdown-toggle"
													data-toggle="dropdown"> <i
													class="icon-circle light-green middle"></i> &nbsp; 
													<span class="white middle bigger-120" id="username_image"></span>
												</a>
											</div>
										</div>
									</div>								
									
									<!-- <div class="clearfix">
										<div class="grid2">
											<span class="bigger-175 blue">25</span> <br /> Followers
										</div>

										<div class="grid2">
											<span class="bigger-175 blue">12</span> <br /> Following
										</div>
									</div> -->

									<div class="hr hr16 dotted"></div>
								</div>

								<div class="span9">									
									<div class="space-12"></div>

									<div class="profile-user-info profile-user-info-striped">
										<div class="profile-info-row">
											<div class="profile-info-name"><span id="profile_salesmanName" class="profile_salesmanName">NVBH</span></div>

											<div class="profile-info-value">
												<span class="editable" >
													<a href="#" id="username"></a></span>
											</div>											
										</div>
										
										<div class="profile-info-row">
											<div class="profile-info-name"><span id="profile_salesmanAddress" class="profile_salesmanAddress">Địa chỉ</span></div>

											<div class="profile-info-value">
												<i class="icon-map-marker light-orange bigger-110"></i> 
												<span class="editable" id="address"></span> 												
											</div>
										</div>

										<!-- <div class="profile-info-row">
											<div class="profile-info-name">Age</div>

											<div class="profile-info-value">
												<span class="editable" id="age">38</span>
											</div>
										</div> -->

										<div class="profile-info-row">
											<div class="profile-info-name">
												<span id="profile_joinedDate" class="profile_joinedDate">Ngày gia nhập</span>
											</div>

											<div class="profile-info-value">
												<span class="editable" id="signup"></span>
											</div>
										</div>

										<div class="profile-info-row">
											<div class="profile-info-name">
												<span id="profile_lastUpdate">Lần cập nhật cuối</span>
											</div>

											<div class="profile-info-value">
												<span class="editable" id="lastupdate"></span>
											</div>
										</div>
										<div class="profile-info-row">
											<div class="profile-info-name">
												<span id="changeAvatar">Thay đổi avatar</span>
											</div>

											<div class="profile-info-value">		
											<form id="uploadPartyContent" method="post" enctype="multipart/form-data" style="margin: 0;">																																	
												<input type="file" id="uploadedFile" name="uploadedFile"/>
												<button type="button" class="btn btn-small btn-purple" id="submitImage">
										        	<i class="icon-cloud-upload"></i>
										        	<span id="profile_uploadAvatar">Tải lên</span>
										        </button>
											</form>																																																													
											</div>
										</div>
										<!-- <div class="profile-info-row">
											<div class="profile-info-name">About Me</div>

											<div class="profile-info-value">
												<span class="editable" id="about">Editable as WYSIWYG</span>
											</div>
										</div> -->
									</div>

									<div class="space-20"></div>
									
									<div class="widget-box transparent">
										<div class="widget-header widget-header-small">
											<h4 class="blue smaller">												
												<i class="icon-rss orange"></i> 
												<strong id="countOrders">Đơn hàng trong hôm nay&nbsp;</strong> 												 
											</h4>											
											<div class="widget-toolbar action-buttons">												
												<a href="#" data-action="reload"> <i
													class="icon-refresh blue"></i>
												</a> &nbsp; <a href="#" class="pink"> <i class="icon-trash"></i></a>
											</div>
										</div>
										<div class="widget-body">										
											<div class="widget-main padding-8">
												<div id="orderToday" class="profile-feed">
												</div>												
											</div>
										</div>
									</div>

									<div class="hr hr2 hr-double"></div>

									<div class="space-6"></div>

									<div class="center">
										<a href="orders.html" class="btn btn-small btn-primary"> <i
											class="icon-rss bigger-150 middle"></i> Xem tất cả các đơn hàng
											<i class="icon-on-right icon-arrow-right"></i>
										</a>
									</div>
								</div>
							</div>
						</div>
						

						<div class="hide">
							<div id="user-profile-2" class="user-profile row-fluid">
								<div class="offset1 span10">								
									<!-- /well -->
									<div class="space"></div>
										<div class="tabbable">
											<ul class="nav nav-tabs padding-16">
												<li class="active"><a data-toggle="tab"
													href="#edit-basic"> <i
														class="green icon-edit bigger-125"></i> <span id="profile_basicInfo">Thông tin cơ bản</span>
												</a></li>

												<!-- <li><a data-toggle="tab" href="#edit-settings"> <i
														class="purple icon-cog bigger-125"></i> Settings
												</a></li> -->

												<li><a data-toggle="tab" href="#edit-password"> <i
														class="blue icon-key bigger-125"></i> 
														<span id="profile_passwd">Mật khẩu</span>	
												</a></li>
											</ul>

											<div class="tab-content profile-edit-tab-content">
												<div id="edit-basic" class="tab-pane in active">
												<form class="form-horizontal" id="editInfomation" method="POST">
													<h4 class="header blue bolder smaller">
														<span id="profile_general">Tổng quát</span>
													</h4>

													<div class="row-fluid">
														<!-- <div class="span4">
															<input type="file" />
														</div>
															 -->
														<div class="vspace"></div>

														<div class="span8">
															<div class="control-group">
																<label class="control-label" for="form-field-username">
																	<span id="profile_userName">Tên đăng nhập</span>
																</label>
																<div class="controls">																
																	<span id="form-field-username"></span>
																</div>
															</div>

															<div class="control-group">
																<label class="control-label" for="form-field-first">
																	<span id="profile_sales"><span id="profile_name">Tên</span></span>
																</label>
																<div class="controls">
																	<input class="input-small" type="text"
																		id="form-field-first" placeholder="First Name"
																		name="firstName" class="required"/> 
																	<input class="input-small" type="text"
																		id="form-field-middle" placeholder="Middle Name"
																		name="middleName"/>	
																	<input class="input-small"
																		type="text" id="form-field-last"
																		placeholder="Last Name" name="lastName" class="required"/>
																</div>
																<div class="space-2"></div>
																<div class="controls">
																	<span id="errorText" class="help-inline"></span>
																</div>																
															</div>
														</div>
													</div>

													<hr />
													<!-- <div class="control-group">
														<label class="control-label" for="form-field-date">Birth
															Date</label>

														<div class="controls">
															<div class="input-append">
																<input class="input-small date-picker" name="birthDate_i18n"
																	id="EditPerson_birthDate_i18n" type="text"
																	data-date-format="dd-MM-yyyy" placeholder="dd-MM-yyyy" />
																<span class="add-on"> 
																	<i class="icon-calendar"></i>
																</span>
															</div>
														</div>
													</div>

													<div class="control-group">
														<label class="control-label">Gender</label>

														<div class="controls">
															<div class="space-2"></div>

															<label class="inline"> <input
																name="form-field-radio" type="radio" class="ace" /> <span
																class="lbl"> Male</span>
															</label> &nbsp; &nbsp; &nbsp; <label class="inline"> <input
																name="form-field-radio" type="radio" class="ace" /> <span
																class="lbl"> Female</span>
															</label>
														</div>
													</div> -->

													<div class="control-group">
														<label class="control-label" for="form-field-comment">
															<span class="profile_salesmanAddress" id="profile_salesmanAddress2">Địa chỉ</span>
														</label>
															
														<div class="controls">
															<input type="text" id="address1" name="address1" size="25">
														</div>
													</div>
													
													<div class="control-group">
														<label class="control-label" for="form-field-email">
														<span class="profile_city" id="profile_city">Thành phố</span></label>

														<div class="controls">																 
															<input type="text" id="form-field-email" value="" size="25"/> 															
														</div>
													</div>													
													

													<div class="space"></div>
													<div class="form-actions" style="margin-bottom: 0px; background-color: white;">
														<button class="btn btn-info btn-small" type="button" id="saveBasicInfoBtn">
															<i class="icon-ok"></i> 
															<span class="profile_save" id="profile_save">Lưu</span>
														</button>
			
														&nbsp; &nbsp; &nbsp;
														<button class="btn btn-small" type="reset" id="resetBasicInfoBtn">
															<i class="icon-undo "></i> 
															<span class="profile_reset" id="">Làm lại</span>
														</button>
													</div>
													</form>
												</div>

												<!-- <div id="edit-settings" class="tab-pane">
													<div class="space-10"></div>

													<div>
														<label class="inline"> <input type="checkbox"
															name="form-field-checkbox" class="ace" /> <span
															class="lbl"> Make my profile public</span>
														</label>
													</div>

													<div class="space-8"></div>

													<div>
														<label class="inline"> <input type="checkbox"
															name="form-field-checkbox" class="ace" /> <span
															class="lbl"> Email me new updates</span>
														</label>
													</div>

													<div class="space-8"></div>

													<div>
														<label class="inline"> <input type="checkbox"
															name="form-field-checkbox" class="ace" /> <span
															class="lbl"> Keep a history of my conversations</span>
														</label> <label class="inline"> <span
															class="space-2 block"></span> for <input type="text"
															class="input-mini" maxlength="3" /> days
														</label>
													</div>
													<div class="form-actions" style="margin-bottom: 0px; background-color: white;">
														<button class="btn btn-info" type="button" id="saveBtn">
															<i class="icon-ok bigger-110"></i> Save
														</button>
			
														&nbsp; &nbsp; &nbsp;
														<button class="btn" type="reset" id="resetBtn">
															<i class="icon-undo bigger-110"></i> Reset
														</button>
													</div>
												</div> -->

												<div id="edit-password" class="tab-pane">
													<div class="space-10"></div>
													<form id="changePasswdForm" method="post" name="changePasswdForm" class="form-horizontal">
													<div class="control-group">
														<label class="control-label" for="currentPassword">
															<span id="profile_currentPw" class="profile_currentPw">Mật khẩu hiện tại</span>
														</label>
														<div class="controls">
															<input type="password" id="currentPassword" name="currentPassword"/>
														</div>
													</div>
													
													<div class="control-group">
														<label class="control-label" for="newPassword">
															<span id="profile_newPw" class="profile_newPw">Mật khẩu mới</span>
														</label>

														<div class="controls">
															<input type="password" id="newPassword" name="newPassword"/>
														</div>
													</div>

													<div class="control-group">
														<label class="control-label" for="newPasswordVerify">
															<span id="profile_confirmPw" class="profile_confirmPw">Xác nhận lại mật khẩu</span>
														</label>

														<div class="controls">
															<input type="password" id="newPasswordVerify" name="newPasswordVerify"/>
														</div>
													</div>
													<div class="form-actions" style= "margin-bottom: 0px; background-color: white;">
														<button class="btn btn-info btn-small" type="button" id="savepwBtn">
															<i class="icon-ok bigger-110"></i> Lưu
														</button>
			
														&nbsp; &nbsp; &nbsp;
														<button class="btn btn-small" type="reset" id="resetpwBtn">
															<i class="icon-undo bigger-110"></i> Làm lại
														</button>
													</div>
													</form>
												</div>
											</div>
										</div>																			
								</div>
								<!-- /span -->
							</div>
							<!-- /user-profile -->
						</div>

						<!-- PAGE CONTENT ENDS -->
					</div>
					<!-- /.span -->
				</div>
				<!-- /.row-fluid -->
			</div>
			<!-- /.page-content -->

			
			<!-- /#ace-settings-container -->
		</div>
		<!-- /.main-content -->
	</div>
	<!-- /.main-container -->

	<a href="#" id="btn-scroll-up"
		class="btn-scroll-up btn btn-small btn-inverse"> <i
		class="icon-double-angle-up icon-only bigger-110"></i>
	</a>

	<!-- basic scripts -->

	<!--[if !IE]> -->

	<script type="text/javascript">
		window.jQuery
				|| document
						.write("<script src='assets/js/jquery-2.0.3.min.js'>"
								+ "<"+"/script>");
	</script>

	<!-- <![endif]-->

	<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

	<script type="text/javascript">
		if ("ontouchend" in document)
			document
					.write("<script src='assets/js/jquery.mobile.custom.min.js'>"
							+ "<"+"/script>");
	</script>
	<script src="assets/js/bootstrap.min.js"></script>

	<!-- page specific plugin scripts -->

	<!--[if lte IE 8]>
		  <script src="assets/js/excanvas.min.js"></script>
		<![endif]-->

	<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
	<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
	<script type="text/javascript" src="assets/js/chosen.jquery.min.js"></script>
	<script src="assets/js/jquery.gritter.min.js"></script>
	<script src="assets/js/bootbox.min.js"></script>
	<script src="assets/js/jquery.slimscroll.min.js"></script>
	<script src="assets/js/jquery.easy-pie-chart.min.js"></script>
	<script src="assets/js/jquery.hotkeys.min.js"></script>
	<script src="assets/js/bootstrap-wysiwyg.min.js"></script>
	<script src="assets/js/select2.min.js"></script>
	<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>
	<script src="assets/js/fuelux/fuelux.spinner.min.js"></script>
	<script src="assets/js/x-editable/bootstrap-editable.min.js"></script>
	<script src="assets/js/x-editable/ace-editable.min.js"></script>
	<script type="text/javascript" src="assets/js/jquery.knob.min.js"></script>	
	<script type="text/javascript" src="assets/js/jquery.autosize-min.js"></script>
	<script src="assets/js/jquery.maskedinput.min.js"></script>
	<!-- <script src="assets/js/jquery-ui-1.10.3.full.min.js"></script> -->
	<script src="assets/js/jquery.validate.min.js"></script>
	
	<!-- ace scripts -->

	<script src="assets/js/ace-elements.min.js"></script>
	<script src="assets/js/ace.min.js"></script>

	<!-- inline scripts related to this page -->
		<script src="assets/js/languages/language.js" type="text/javascript"></script>
	
		
	<script type="text/javascript">
		var languageObject = null;
		var lang = null;
		$("#loading").hide();
		//var key_payment_finish_btn = "viewOrder_payment";
		function language_select(language){
			//alert("test");
			//lang = language;
			//languageObject = changeLanguage('config/profile.json', lang);
			//console.log(languageObject);
		}
		$.get("header.html", function(data) {
			$('#navbar').html(data);
		}, 'html').fail(function() {
			console.log('arge', arguments)
		});
		jQuery(function($) {
		
			//editables on first profile page
			$.fn.editable.defaults.mode = 'inline';
			$.fn.editableform.loading = "<div class='editableform-loading'><i class='light-blue icon-2x icon-spinner icon-spin'></i></div>";
			$.fn.editableform.buttons = '<button type="submit" class="btn btn-info editable-submit" id="editable-submit"><i class="icon-ok icon-white"></i></button>'
					+ '<button type="button" class="btn editable-cancel"><i class="icon-remove"></i></button>';
			
			$('#uploadedFile, #id-input-file-2').ace_file_input({
				no_file:'No File ...',
				btn_choose:'Choose',
				btn_change:'Change',
				droppable:false,
				onchange:null,								
				thumbnail:false //| true | large
				/* whitelist:'gif|png|jpg|jpeg' */				
				/* blacklist:'exe|php' */
				//onchange:''
				//
			});	
			
			$('#uploadPartyContent').on('submit', function(e){			    				    			    
				//$('#uploadPartyContent').attr('action',localStorage.serverUrl + 'mobileservices/control/editAvatarSalesman');															
			  	//alert('submit');
				e.preventDefault();
				var formData1 = new FormData($('#uploadPartyContent')[0]);
				var fileName = $("#uploadedFile")[0].files[0];
				formData1.append("filename",fileName.name);
				/* var xhr = new XMLHttpRequest();
				xhr.open('POST', localStorage.serverUrl + 'mobileservices/control/editAvatarSalesman', true);
				xhr.onload = function () {
					  if (xhr.status === 200) {
					    // File(s) uploaded.
					    alert('Upload');
					  } else {
					    alert('An error occurred!');
					  }
					};
					// Send the Data.
					xhr.send(formData1); */
				//alert(fileName.name);{responseMessage=success, contentId=10002}
					$("#loading").show();
				  $.ajax({
				      url: localStorage.serverUrl + 'mobileservices/control/editAvatarSalesman',
				      type: 'POST',
				      dataType: 'json',
				      //enctype: "multipart/form-data",
				      data: formData1,	
				     /*  xhr: function() {  // Custom XMLHttpRequest
				            var myXhr = $.ajaxSettings.xhr();
				            if(myXhr.upload){ // Check if upload property exists
				                //myXhr.upload.addEventListener('progress',progressHandlingFunction, false); // For handling the progress of the upload
				            }
				            return myXhr;
				        }, */
				      success: function(data) {
				      	//location.reload();
				      	//console.log(data);
				      	if(data.resultUpdate.responseMessage.indexOf("success") > -1){
				      		bootbox.dialog("Cập nhật thành công ", [{
					    		   'label': 'OK',
					    		   'class': 'btn-primary btn-small',
					    		   'callback': function(){
					    			   location.reload();
					    		   }
					    	   }]);
				      	}else{
				      		bootbox.dialog("Xảy ra lỗi trong quá trình cập nhật", [{
					    		   'label': 'OK',
					    		   'class': 'btn-danger btn-small'
					    	   }]);
				      	}
				      },
				      error: function(textStatus, errorThrown){
				    	   //$("#test").html(textStatus);
				    	   bootbox.dialog("Xảy ra lỗi ", [{
				    		   'label': 'OK',
				    		   'class': 'btn-danger btn-small'
				    	   }]);
				      },
				      complete: function(jqXHR, textStatus){
							$("#loading").hide();
						},
				      cache: false,
				      processData: false,
				      contentType: false 
				    });
				});
			$("#submitImage").click(function(){
				$('#uploadPartyContent').attr('action',localStorage.serverUrl + 'mobileservices/control/editAvatarSalesman');
				$('#uploadPartyContent').submit();  
			});
			
			$("#loading").show();
			$.ajax({
				url : localStorage.serverUrl + 'mobileservices/control/getCustomerInfo',
				crossDomain: true,
				type : "POST",
				dataType : 'json', // Choosing a JSON datatype
				success: function(data){					
					//$("#test").html(JSON.stringify(data["customerInfo"]));
					localStorage.cusInfo = JSON.stringify(data["customerInfo"]);
					fillCusInfo(data["customerInfo"]);
				},
				error: function(textStatus, errorThrown){
					//$("#test").text(JSON.stringify(textStatus));
					dataCus = JSON.parse(localStorage.cusInfo);
					dataCus["contentImageUrl"] = null; 
					fillCusInfo(dataCus);
				},
				complete: function( jqXHR, textStatus){
					$("#loading").hide();
				}
			});					
			
			$.ajax({
				url : localStorage.serverUrl + 'mobileservices/control/orderHeaderListView',
				crossDomain: true,
				type: 'POST',
				data:{
					filterDate: 'today'
				},
				dataType: 'json',
				success: function(data){
					fillOrderToday(data);
				},
				error: function(textStatus, errorThrown){
					
				}
			});			
			
			$.ajax({
				url : localStorage.serverUrl + 'mobileservices/control/getNotification',
				crossDomain: true,
				type : "POST",
				dataType : 'json', // Choosing a JSON datatype
				success: function(data){
					localStorage.notify = JSON.stringify(data);
					//$("#test").text(localStorage.notify);
					var $iTask = 0;
					if(data['middleTopMessage1']){
						$iTask++;
						$("#itask1").css("display", "block");
						//$("a#middleTopLink1").attr("href",data["middleTopLink1"]);
						$("#middleTopMessage1").text(data['middleTopMessage1']);
					}	
					if(data['middleTopMessage2']){
						$iTask++;
						$("#itask2").css("display", "block");
						//$("a#middleTopLink2").attr("href",data["middleTopLink2"]);
						$("#middleTopMessage2").text(data['middleTopMessage2']);
					}	
					if(data['middleTopMessage3']){
						$iTask++;
						$("#itask3").css("display", "block");
						//$("a#middleTopLink3").attr("href",data["middleTopLink3"]);
						$("#middleTopMessage3").text(data['middleTopMessage3']);
					}
					$('.iTask').text($iTask);
				},
				error: function(textStatus, errorThrown){
					$("#test").text(JSON.stringify(textStatus));
				}
			});	
			$("a#middleTopLink1").click(function(event){
				localStorage.taskLink = JSON.parse(localStorage.notify)["middleTopLink1"];
				location = "TaskDetails.html";
				event.preventDefault();
			});
			
			$("a#middleTopLink2").click(function(event){
				localStorage.taskLink = $("a#middleTopLink2").attr("href");
				location = "TaskDetails.html";
				event.preventDefault();
			});
			
			$("a#middleTopLink3").click(function(event){
				localStorage.taskLink = $("a#middleTopLink3").attr("href");
				window.location = "TaskDetails.html";
				event.preventDefault();
			});
			
			function fillCusInfo(dataCus){
				//dataCus = JSON.parse(data);
				if(!dataCus.firstName && !dataCus.middleName && !dataCus.lastName){
					name = 'Tên chưa xác định';
				}else if(dataCus.middleName){
					name = dataCus.firstName + ' ' + dataCus.middleName + ' ' +dataCus.lastName;
				}else{
					name = dataCus.firstName + ' ' + dataCus.lastName;
				}
				
				$('a#username').text(name);
				$("#form-field-first").val(dataCus.firstName);
				$("#form-field-middle").val(dataCus.middleName);
				$("#form-field-last").val(dataCus.lastName);
				
				$('#form-field-username').text(localStorage.userName);
				$('#username_image').html(localStorage.userName);
				$('.user_name').html(localStorage.userName);
				var dateLastUpdate = dataCus.lastUpdatedTxStamp;
				//var dateLastUpdateObj = new Date(dateLastUpdate["time"]);
				$('#lastupdate').html(dateLastUpdate);	
				var dateJoined = dataCus.createdTxStamp;
				//var dateJoinObj = new Date(dateJoined["time"]);
				$('#signup').html(dateJoined);
				var address1 = dataCus.address1;				
				if(address1){
					if(address1.indexOf("No_Address") > -1){
						
						$("#address").html("Chưa thiết lập");
					}
					else{
						$("#address").html(address1);
					}
				}
				if(dataCus["contentImageUrl"]){
					//alert(dataCus["contentImageUrl"]);
					image_avatar = document.getElementById("avatar"); 
					image_avatar.addEventListener("load", function(){
						var imgCanvas = document.createElement("canvas");
						imgContext = imgCanvas.getContext("2d");
						imgCanvas.width = image_avatar.width;
						imgCanvas.height = image_avatar.height;
						imgContext.drawImage(image_avatar, 0, 0, image_avatar.width, image_avatar.height);
						profile_picture = imgCanvas.toDataURL("image/jpeg");
						try{
							localStorage.setItem("profile_picture", JSON.stringify(profile_picture));	
						}catch(e){
							console.log("Storage failed: " + e);
						}
					}, false);
					//image_avatar.setAttribute("src", dataCus["contentImageUrl"]);
					$("img",".profile-picture").attr("src", dataCus["contentImageUrl"]);					
				}else{
					//working offline
					var profile_picture = JSON.parse(localStorage.getItem("profile_picture"));					
					if(profile_picture)						
						$("img",".profile-picture").attr("src", profile_picture);
				}							
			} 
			
			$("#savepwBtn").click(function(){
				$("form#changePasswdForm").submit();
			});
			
			$("#changePasswdForm").validate({
				errorElement: 'span',
				errorClass: 'help-inline',
				focusInvalid: true,
				rules:{
					currentPassword: {
						required: true					
					},
					newPassword: {
						required: true,
						minlength: 5
					},
					newPasswordVerify: {
						required: true,
						minlength: 5,
						equalTo: "#newPassword"
					}
				},
				messages:{
					currentPassword: {
						required: 'nhập mật khẩu hiện tại!!'
					},
					newPassword: {
						required: "Nhập mật khẩu mới!",
						minlength: 'Mật khẩu phải chứa có ít nhất 5 kí tự',						
					},
					newPasswordVerify: {
						required: "Xác nhận mật khẩu!!",
						equalTo: "Mật khẩu mới và xác nhận mật khẩu không trùng nhau!!"
					}
				},
				invalidHandler: function (event, validator) { //display error alert on form submit   
					$('.alert-error', $('.login-form')).show();
				},

				highlight: function (e) {
					$(e).closest('.control-group').removeClass('info').addClass('error');
				},

				success: function (e) {
					$(e).closest('.control-group').removeClass('error').addClass('info');
					$(e).remove();
				},

				errorPlacement: function (error, element) {
					if(element.is(':checkbox') || element.is(':radio')) {
						var controls = element.closest('.controls');
						if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
						else error.insertAfter(element.nextAll('.lbl').eq(0));
					} 
					else if(element.is('.chzn-select')) {
						error.insertAfter(element.nextAll('[class*="chzn-container"]').eq(0));
					}
					else error.insertAfter(element);
				},

				submitHandler: function (form) {
					changePasswd();
				},
				invalidHandler: function (form) {
					//alert("invalid");
					return false;
				}
			});
			
			$('#age').editable({
				type : 'spinner',
				name : 'age',
				spinner : {
					min : 16,
					max : 99,
					step : 1
				}
			});
						
			validator = $("form#editInfomation").validate({
				rules:{
					firstName: "required",
					lastName:  "required"
				},
				messages:{
					firstName: "Nhập thông tin về tên!!",
					lastName:  "Nhập thông tin về họ!!"
				},					
				invalidHandler: function (event, validator) { //display error alert on form submit   
					$('.alert-error', $('.login-form')).show();
				},

				highlight: function (e) {
					$(e).closest('.control-group').removeClass('info').addClass('error');
				},

				success: function (e) {
					$(e).closest('.control-group').removeClass('error').addClass('info');
					$(e).remove();
				},

				errorPlacement: function (error, element) {
					if(element.is(':checkbox') || element.is(':radio')) {
						var controls = element.closest('.controls');
						if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
						else error.insertAfter(element.nextAll('.lbl').eq(0));
					} 
					else if(element.is('.chzn-select')) {
						error.insertAfter(element.nextAll('[class*="chzn-container"]').eq(0));
					}
					else error.appendTo("#errorText");
				},

				submitHandler: function (form) {
					//alert("submit");
					editSalesman();
				},					
				//errorLabelContainer: "#dialogErrorNameForm" 
			});
			
			$("#saveBasicInfoBtn").on("click", function(){	
				if(validator.form()){
					$("#editInfomation").submit();					
				}
				//alert("111");
			});
			
			/* $("#editInfomation").submit(function(event){
				event.preventDefault();				 
							
				 //event.unbind();
			}); */
			//editables 
			/* $('#username').editable({
				type : 'text',
				name : 'username'
			}); */
			/* $("a#username").on("click", function(){
				$("#dialogEditNameForm").dialog("open");
			});			
			 */
			var countries = [];
			$.each({
				"CA" : "Canada",
				"IN" : "India",
				"NL" : "Netherlands",
				"TR" : "Turkey",
				"US" : "United States"
			}, function(k, v) {
				countries.push({
					id : k,
					text : v
				});
			});

			var cities = [];
			cities["CA"] = [];
			$.each([ "Toronto", "Ottawa", "Calgary", "Vancouver" ], function(k,v) {
				cities["CA"].push({
					id : v,
					text : v
				});
			});
			cities["IN"] = [];
			$.each([ "Delhi", "Mumbai", "Bangalore" ], function(k, v) {
				cities["IN"].push({
					id : v,
					text : v
				});
			});
			cities["NL"] = [];
			$.each([ "Amsterdam", "Rotterdam", "The Hague" ], function(k, v) {
				cities["NL"].push({
					id : v,
					text : v
				});
			});
			cities["TR"] = [];
			$.each([ "Ankara", "Istanbul", "Izmir" ], function(k, v) {
				cities["TR"].push({
					id : v,
					text : v
				});
			});
			cities["US"] = [];
			$.each(
					[ "New York", "Miami", "Los Angeles", "Chicago",
							"Wysconsin" ], function(k, v) {
						cities["US"].push({
							id : v,
							text : v
						});
					});

			var currentValue = "NL";
			
			$('#country').editable(
					{
						type : 'select2',
						value : 'NL',
						source : countries,
						success : function(response, newValue) {
							if (currentValue == newValue)
								return;
							currentValue = newValue;

							var new_source = (!newValue || newValue == "") ? []
									: cities[newValue];

							//the destroy method is causing errors in x-editable v1.4.6
							//it worked fine in v1.4.5
							/**			
							$('#city').editable('destroy').editable({
								type: 'select2',
								source: new_source
							}).editable('setValue', null);
							 */

							//so we remove it altogether and create a new element
							var city = $('#city').removeAttr('id').get(0);
							$(city).clone().attr('id', 'city').text('Select City').editable({
								type : 'select2',
								value : null,
								source : new_source
							}).insertAfter(city);//insert it after previous instance
							$(city).remove();//remove previous instance

						}
					});

			$('#city').editable({
				type : 'select2',
				value : 'Amsterdam',
				source : cities[currentValue]
			});
								
			/* $('#signup').editable({
				type : 'date',
				format : 'yyyy-mm-dd',
				viewformat : 'dd/mm/yyyy',
				datepicker : {
					weekStart : 1
				}
			}); */
			
			
			/* $('#address').editable({
				type: 'text',
				name: 'address'				
			}); */
			//var $range = document.createElement("INPUT");
			//$range.type = 'range';
			$('#login').editable({
				type : 'slider',//$range.type == 'range' ? 'range' : 'slider',
				name : 'login',
				slider : {
					min : 1,
					max : 50,
					width : 100
				},
				success : function(response, newValue) {
					if (parseInt(newValue) == 1)
						$(this).html(newValue + " hour ago");
					else
						$(this).html(newValue + " hours ago");
				}
			});

			$('#about').editable({
				mode : 'inline',
				type : 'wysiwyg',
				name : 'about',
				wysiwyg : {
				//css : {'max-width':'300px'}
				},
				success : function(response, newValue) {
				}
			});

			// *** editable avatar *** //
			try {//ie8 throws some harmless exception, so let's catch it

				//it seems that editable plugin calls appendChild, and as Image doesn't have it, it causes errors on IE at unpredicted points
				//so let's have a fake appendChild for it!
				if (/msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase()))
					Image.prototype.appendChild = function(el) {
					}

				var last_gritter;
				
				var editImageUrl = localStorage.serverUrl + 'mobileservices/control/editAvatarSalesman';
				$("#avatar").on('shown', function(e, editable){
					//console.log(editable);
					formData = $('#avatar').next().find('form');
					formData.attr('action', editImageUrl);
					formData.attr('enctype', 'multipart/form-data');
					formData.attr('method', 'post');
				});
				
				$('#avatar').editable({
									type : 'image',
									name : 'avatar',
									value : null,
									 ajaxOptions:{
											type: 'post' 
										 },	
									image : {
										//specify ace file input plugin's options here
										btn_choose : 'Change Avatar',
										droppable : true,
										/**
										//this will override the default before_change that only accepts image files
										before_change: function(files, dropped) {
											return true;
										},
										 */
										
										//and a few extra ones here
										name : 'avatar',//put the field name here as well, will be used inside the custom plugin										
										max_size : 110000,//~100Kb
										on_error : function(code) {//on_error function will be called when the selected file has a problem
											if (last_gritter)
												$.gritter.remove(last_gritter);
											if (code == 1) {//file format error
												last_gritter = $.gritter.add({
															title : 'File is not an image!',
															text : 'Please choose a jpg|gif|png image!',
															class_name : 'gritter-error gritter-center'
															});
											} else if (code == 2) {//file size rror
												last_gritter = $.gritter.add({
															title : 'File too big!',
															text : 'Image size should not exceed 100Kb!',
															class_name : 'gritter-error gritter-center'
														});
											} else {//other error
											}
										},
										on_success : function() {											
											$.gritter.removeAll();
										}
									},
									
									//url: editImageUrl,
									//pk:"1",
									send: 'auto',
									
									url: function(params) {
										// ***UPDATE AVATAR HERE*** //
										//You can replace the contents of this function with examples/profile-avatar-update.js for actual upload

										var deferred = new $.Deferred										
										//if value is empty, means no valid files were selected
										//but it may still be submitted by the plugin, because "" (empty string) is different from previous non-empty value whatever it was
										//so we return just here to prevent problems
										var value = $('#avatar').next().find('input[type=hidden]:eq(0)').val();
																			
										if (!value || value.length == 0) {
											deferred.resolve();
											return deferred.promise();
										}									
										//$("#test").html($('#avatar').next().find('img'));										
										//var imagedata = $('#avatar').next().find('input[type=file]:eq(0)').prop('files')[0];
										params.fileName = $('#avatar').next().find(".file-name").attr("data-title");																											
										//alert(uploadedFile);
										//formData = $('#avatar').next().find('form');
										//alert(formData);
										//formData.attr('enctype', 'multipart/form-data');
										//formData.attr('action', editImageUrl);
										
										//params.dataSubmit = formData.serialize();
										
										
										//dummy upload
										/* setTimeout(function() {
													if ("FileReader" in window) {
														//for browsers that have a thumbnail of selected image
														var thumb = $('#avatar').next().find('img').data('thumb');
														//alert(thumb);
														//if (thumb) $('#avatar').get(0).src = thumb;
													}

													deferred.resolve({
														'status' : 'OK'
													});

													if (last_gritter)
														$.gritter.remove(last_gritter);
													last_gritter = $.gritter.add({
																title : 'Avatar Updated!',
																text : 'Uploading to server can be easily implemented. A working example is included with the template.',
																class_name : 'gritter-info gritter-center'
															});

												},parseInt(Math.random() * 800 + 800)) */

										return params;
									},

									success : function(response, newValue) {
										//$('#avatar').next().find('form').submit();
										/* form1.submit(function(){											
											var formData1 = new FormData($(this)[0]);
											alert(formData1);
											$.ajax({
											      url: editImageUrl,
											      type: 'POST',
											      data: formData1,
											      cache: false,
											      processData: false,
											      contentType: false,
											      success: function (data) {
											            alert(data);
											        },
											        error: function(textStatus, errorThrown){
											    	   $("#test").html(textStatus);
											       } 
											    });
										}); */
									}
								});
			} catch (e) {
			}
			
			
			//another option is using modals
			$('#avatar2').on('click', function() {
								var modal = '<div class="modal hide fade">\
						<div class="modal-header">\
							<button type="button" class="close" data-dismiss="modal">&times;</button>\
							<h4 class="blue">Change Avatar</h4>\
						</div>\
						\
						<form class="no-margin">\
						<div class="modal-body">\
							<div class="space-4"></div>\
							<div style="width:75%;margin-left:12%;"><input type="file" name="file-input" /></div>\
						</div>\
						\
						<div class="modal-footer center">\
							<button type="submit" class="btn btn-small btn-success"><i class="icon-ok"></i> Submit</button>\
							<button type="button" class="btn btn-small" data-dismiss="modal"><i class="icon-remove"></i> Cancel</button>\
						</div>\
						</form>\
					</div>';
								var modal = $(modal);
								modal.modal("show").on("hidden", function() {
									modal.remove();
								});

								var working = false;

								var form = modal.find('form:eq(0)');
								var file = form.find('input[type=file]').eq(0);
								file.ace_file_input({
											style : 'well',
											btn_choose : 'Click to choose new avatar',
											btn_change : null,
											no_icon : 'icon-picture',
											thumbnail : 'small',
											before_remove : function() {
												//don't remove/reset files while being uploaded
												return !working;
											},
											before_change : function(files,
													dropped) {
												var file = files[0];
												if (typeof file === "string") {
													//file is just a file name here (in browsers that don't support FileReader API)
													if (!(/\.(jpe?g|png|gif)$/i)
															.test(file))
														return false;
												} else {//file is a File object
													var type = $
															.trim(file.type);
													if ((type.length > 0 && !(/^image\/(jpe?g|png|gif)$/i)
															.test(type))
															|| (type.length == 0 && !(/\.(jpe?g|png|gif)$/i)
																	.test(file.name))//for android default browser!
													)
														return false;

													if (file.size > 110000) {//~100Kb
														return false;
													}
												}

												return true;
											}
										});

								form.on('submit', function() {
													if (!file.data('ace_input_files'))
														return false;

													file.ace_file_input('disable');
													form.find('button').attr('disabled', 'disabled');
													form.find('.modal-body').append("<div class='center'><i class='icon-spinner icon-spin bigger-150 orange'></i></div>");

													var deferred = new $.Deferred;
													working = true;
													deferred.done(function() {
																form.find('button').removeAttr('disabled');
																form.find('input[type=file]').ace_file_input('enable');
																form.find('.modal-body > :last-child').remove();
																modal.modal("hide");

																var thumb = file.next().find('img').data('thumb');
																if (thumb)
																	$('#avatar2').get(0).src = thumb;

																working = false;
															});

													setTimeout(function() {
																deferred.resolve();
															},
															parseInt(Math.random() * 800 + 800));
													return false;
												});
			});
								    						
			
						
			
			$('.profile-social-links > a').tooltip();

			$('.easy-pie-chart.percentage').each(function() {
				var barColor = $(this).data('color') || '#555';
				var trackColor = '#E2E2E2';
				var size = parseInt($(this).data('size')) || 72;
				$(this).easyPieChart({
					barColor : barColor,
					trackColor : trackColor,
					scaleColor : false,
					lineCap : 'butt',
					lineWidth : parseInt(size / 10),
					animate : false,
					size : size
				}).css('color', barColor);
			});

			///////////////////////////////////////////

			//show the user info on right or left depending on its position
			$('#user-profile-2 .memberdiv').on(
					'mouseenter',
					function() {
						var $this = $(this);
						var $parent = $this.closest('.tab-pane');

						var off1 = $parent.offset();
						var w1 = $parent.width();

						var off2 = $this.offset();
						var w2 = $this.width();

						var place = 'left';
						if (parseInt(off2.left) < parseInt(off1.left)
								+ parseInt(w1 / 2))
							place = 'right';

						$this.find('.popover').removeClass('right left')
								.addClass(place);
					}).on('click', function() {
				return false;
			});

			///////////////////////////////////////////
			$('#user-profile-2')
					.find('input[type=file]')
					.ace_file_input(
							{
								style : 'well',
								btn_choose : 'Change avatar',
								btn_change : null,
								no_icon : 'icon-picture',
								thumbnail : 'large',
								droppable : true,
								before_change : function(files, dropped) {
									var file = files[0];
									if (typeof file === "string") {//files is just a file name here (in browsers that don't support FileReader API)
										if (!(/\.(jpe?g|png|gif)$/i).test(file))
											return false;
									} else {//file is a File object
										var type = $.trim(file.type);
										if ((type.length > 0 && !(/^image\/(jpe?g|png|gif)$/i)
												.test(type))
												|| (type.length == 0 && !(/\.(jpe?g|png|gif)$/i)
														.test(file.name))//for android default browser!
										)
											return false;

										if (file.size > 110000) {//~100Kb
											return false;
										}
									}

									return true;
								}
							}).end().find('button[type=reset]').on(ace.click_event, function() {
								$('#user-profile-3 input[type=file]')
										.ace_file_input('reset_input');
							}).end().find('.date-picker').datepicker().next()
					.on(ace.click_event, function() {
						$(this).prev().focus();
					})
			$('.input-mask-phone').mask('(999) 999-9999');

			////////////////////
			//change profile
			$('[data-toggle="buttons-radio"]').on('click', function(e) {
				var target = $(e.target);
				var which = parseInt($.trim(target.text()));
				$('.user-profile').parent().hide();
				$('#user-profile-' + which).parent().show();
			});						
		});
		
		
		
		function emptyPasswdValue(){
			$("#newPassword").val("");
			$("#currentPassword").val("");					
			$("#newPasswordVerify").val("");
		}
		
		function editSalesman(){
			var postData = $("#editInfomation").serialize();
			$("#loading").show();
			$.ajax({
				url: localStorage.serverUrl + 'mobileservices/control/updatePerson',
				type:"POST",
				data: postData,
				dataType: "json",
				async: false,
				success: function(data, textStatus, jqXHR){
					//$("#test").html(JSON.stringify(data));
					//alert(data["_EVENT_MESSAGE_"]);{responseMessage=success, successMessage=Person successfully updated.}
					if(data.updateMessage.responseMessage.indexOf("success") > -1){
						bootbox.dialog("Cập nhật thành công",[{
							"label": "OK",
							"class":"btn-small btn-primary",
							"callback": function(){
								location.reload();		
							}
						}]);
						
					}else{
						bootbox.dialog("Xảy ra lỗi trong quá trình cập nhật",[{
							"label": "OK",
							"class":"btn-small btn-primary"
						}]); 	
					}
					
					//	
				}, 
				error: function(jqXHR, textStatus, errorThrown){
					bootbox.dialog("Error: " + errorThrown, [{
						"label" : "OK",
						"class" : "btn-small btn-primary",
						}]
					);
				},
				complete: function( jqXHR, textStatus){
					$("#loading").hide();
				}
			});	
		}
		
		function changePasswd(){				
			dataSubmit = $("#changePasswdForm").serialize();
			$.ajax({
				url: localStorage.serverUrl + 'mobileservices/control/updatePassword',
				crossDomain: true,
				type: 'POST',
				dataType : 'JSON',
				data: dataSubmit,
				success: function(data, textStatus, jqXHR){
					//$("#test").html(JSON.stringify(data));
					if(data.responseMessage === "success"){
						bootbox.dialog("Update password successful",[{
							"label": "OK",
							"class" : "btn-small btn-primary",
							"callback":function(){
								location.reload();
							}								
						}]);
					}else{
						if(!jQuery.isEmptyObject(data.errorMessageList)){
							var errors = "";
							for(var index in data.errorMessageList){
								errors += data.errorMessageList[index] + " ";
							}
							bootbox.dialog("The following error occur: " + errors, [{
								"label": "Try again",
								"class" : "btn-small btn-primary",
								"callback": function(){
									emptyPasswdValue();	
								}
							}]);
						}else{
							bootbox.dialog("Error update password!! Try again!", [{
								"label": "Try again",
								"class" : "btn-small btn-primary",
								"callback": function(){
									emptyPasswdValue();
								}
							}]);
						}							
					}						
				}
			});				
		}
		
		
		function fillOrderToday(data){
			var orderHeaderList = data.orderHeaderList;
			var countOrders = Object.keys(orderHeaderList).length;
			//alert(countOrders);
			$("#countOrders").append("(" + countOrders + ")");
			//alert(countOrders);
			if(!jQuery.isEmptyObject(orderHeaderList)){	
				if(Object.keys(orderHeaderList).length >= 4){
					$('#orderToday').slimScroll({
						height: '250px',
						alwaysVisible : true
					});
				}
				//console.log("ssss"+Object.keys(orderHeaderList).length);
				
				for(var index in orderHeaderList){
					var timeCreated = new Date(orderHeaderList[index].time);
					var timeAgo = timeSince(timeCreated);
					var newDiv = "<div class='profile-activity clearfix'>";
						newDiv += "<div><i class='pull-left thumbicon icon-shopping-cart no-hover'></i>";
						newDiv += "<a class='user' href='javascript:void(0);' onclick='javascript:viewOrder(\"" + orderHeaderList[index].orderId + "\")'>"+orderHeaderList[index].orderId+"</a>&nbsp;";
						//newDiv += "<td>"+orderHeaderList[index].orderType+"</td>";
						newDiv += "-&nbsp;<b>Khách hàng</b>:&nbsp;" + orderHeaderList[index].billToParty + "&nbsp;" + 
								   "-&nbsp;<b>Tổng số tiền:</b>&nbsp;" + orderHeaderList[index].grandTotal +"&nbsp;" +
						            "-&nbsp;<b>Trạng thái:</b>&nbsp;" + orderHeaderList[index].status+"&nbsp;";	
						newDiv += "<div class='time'><i class='icon-time bigger-110'></i>" + timeAgo;
						
						newDiv += "</div>";
						newDiv += "</div></div>";
					$("#orderToday").append(newDiv);
				}				
			}else{				
				var newDiv = "<div class='profile-activity clearfix'>";
				newDiv += "<div><i class='pull-left thumbicon icon-shopping-cart no-hover'></i>";
				newDiv += "Chưa có đơn hàng nào được tạo</div></div>";
				$("#orderToday").append(newDiv);
			}			
		}
		
		function timeSince(date){
			var seconds = Math.floor((new Date() - date) / 1000);

		   // var interval = Math.floor(seconds / 31536000);

		    /* if (interval > 1) {
		        return interval + " years";
		    }
		    interval = Math.floor(seconds / 2592000);
		    if (interval > 1) {
		        return interval + " months";
		    }
		    interval = Math.floor(seconds / 86400);
		    if (interval > 1) {
		        return interval + " days";
		    } */
		   
		    var interval = Math.floor(seconds / 3600);
		    if (interval >= 1) {
		        return "&nbsp;khoảng " + interval + "&nbsp;giờ " + (Math.floor(seconds / 60) - interval * 60 )+ " phút trước";
		    }
		    interval = Math.floor(seconds / 60);
		    if (interval >= 1) {
		        return "&nbsp;khoảng " + interval + "&nbsp;phút trước";
		    }
		    return /* Math.floor(seconds) + " seconds" */ "&nbsp;vừa xong";
		}
		
	</script>	
</body>
</html>
