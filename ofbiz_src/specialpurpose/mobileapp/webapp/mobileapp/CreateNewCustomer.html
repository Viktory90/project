<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Tạo khách hàng mới</title>
	<meta name="description" content=" and Validation" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<!-- basic styles -->
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet" />

	<link rel="stylesheet" href="assets/css/font-awesome.min.css" />
	<!--[if IE 7]>
	  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
	<![endif]-->


	<!-- page specific plugin styles -->
	
	<link rel="stylesheet" href="assets/css/chosen.css" />

	<!-- ace styles -->
	<link rel="stylesheet" href="assets/css/ace.min.css" />
	<link rel="stylesheet" href="assets/css/ace-responsive.min.css" />
	<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
	<link rel="stylesheet" href="assets/css/custom/loading.css">
	
	<!--[if lt IE 9]>
	  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
	<![endif]-->

</head>
<body>
	<span id="navbar"> </span>
	<div class="main-container container-fluid">
		<div id="test"></div>
		<div class="main-container-inner">
			<div class="sidebar" id="sidebar">
			</div>
			<div class="main-content">
				<div class="page-content">	
					<div class="page-header">					
						<h1><span id="createNewCustomer_page-header">Khách hàng</span>
						<small>
							<i class="icon-double-angle-right"></i>
							<span id="createNewCustomer_title">Tạo mới khách hàng</span>
						</small>
						</h1>
					</div>
					<div class="row-fluid">	
				<div class="row-fluid">
					<div class="span12">
						<div id="loading">								
							<i class="icon-spinner icon-spin orange bigger-250" id="loading_image"></i>														
						</div>
						<div class="widget-box">
							<div class="widget-header widget-header-blue widget-header-flat wi1dget-header-large">
								<h4 class="lighter"><span id="createNewCustomer_widget-header">Tạo khách hàng mới</span></h4>								
							</div>
						</div>
						<div class="widget-body">
			 				<div class="widget-main">
			 					<div class="row-fluid">
			 						<div class="step-content row-fluid position-relative">
			 							<div class="step-pane active">
			 								<h3 class="lighter block green">
			 									<span id="createNewCustomer_formTitle">Nhập thông tin khách hàng</span>
		 									</h3>
			 								<form id="customer-form" class="form-horizontal">
			 									<div class="control-group">
													<label class="control-label" for="groupName">
														<span id="createNewCustomer_customerName">Tên khách hàng</span>(*):
													</label>
													<div class="controls">
														<span class="span12">
															<input class="span6" type="text" id="groupName" name="groupName" />
														</span>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label" for="officeSite">
														<span id="createNewCustomer_officesite">Office site</span>:
													</label>
													<div class="controls">
														<span class="span12">
															<input class="span6" type="text" id="officeSite" name="officeSite" />
														</span>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label" for="address1">
														<span id="createNewCustomer_cusAddress">Địa chỉ khách hàng</span> (*):
													</label>
													<div class="controls">
														<span class="span12">
															<input class="span6" type="text" id="address1" name="address1" />
														</span>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label" for="city"><span id="createNewCustomer_city">Thành phố</span> (*):</label>
													<div class="controls">
														<span class="span12">
															<input class="span6" type="text" id="city" name="city" />
														</span>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label" for="roadId">
														<span id="createNewCustomer_road">Tuyến đường</span> (*):
													</label>
													<div class="controls">
														<span class="span12">
															<select class="span3" id="road" name="roadId">
															
															</select>
														</span>
													</div>
												</div>
												<div class="control-group">
													<label class="control-label" for="postalCode">
														<span id="createNewCustomer_zipcode">Zip code</span> (*):</label>
													<div class="controls">
														<span class="span12">
															<input class="span6" type="text" id="postalCode" name="postalCode" />
														</span>
													</div>
												</div>
												<div class="control-group">
													<button class="btn btn-info btn-small" id="capture_cus" onclick="location = 'ChupAnhKhachHang.html'"><i class="icon-camera"></i>
														<span id="">Chụp ảnh KH</span>
													</button>
												</div>
			 								</form>
			 							</div>
			 						</div>
			 						<hr />
					
									<div class="form-actions">
										<button class="btn btn-info btn-small" id="save_new_cus"><i class="icon-ok"></i>
											<span id="createNewCustomer_saveCus">Tạo mới</span>
										</button>
										<button class="btn btn-small" data-last="Finish" id="cancel"><i class="icon-undo bigger-110"></i>
											<span id="createNewCustomer_return">Quay lại</span>
										</button>
									</div>
			 					</div>
			 				</div>
			 			</div>	
					</div>	
				</div>
				</div>
				</div>
			
			</div>		
		</div>
	</div>
	<!-- basic scripts -->
		<script type="text/javascript">
		window.jQuery
				|| document
						.write("<script src='assets/js/jquery-2.0.3.min.js'>"
								+ "<"+"/script>");
		</script>
		
		<script src="assets/js/bootstrap.min.js"></script>

		<!-- page specific plugin scripts -->
		
		<!-- <script type="text/javascript" src="assets/js/fuelux.wizard.js"></script> -->

		<script type="text/javascript" src="assets/js/jquery.validate.min.js"></script>

		<script type="text/javascript" src="assets/js/bootbox.min.js"></script>

		<script type="text/javascript" src="assets/js/jquery.maskedinput.min.js"></script>

		<script type="text/javascript" src="assets/js/chosen.jquery.min.js"></script>
		
		
		<!-- ace scripts -->
		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>


		<!-- inline scripts related to this page -->
		<script src="assets/js/languages/language.js" type="text/javascript"></script>
		<script type="text/javascript">
		var languageObject = null;
		var lang = null;
		function language_select(language){
			//var mySelect = document.getElementById("select_language");
			//lang = language;
			//languageObject = changeLanguage('config/createNewCustomer.json', lang);	
		}
		
		jQuery(function($){	
			$.get("header.html", function(data) {
				$('#navbar').html(data);
			}, 'html').fail(function() {
				console.log('arge', arguments)
			});
			
			$.get("sidebar.html", function (data){
		    	$('#sidebar').html(data);  
		    }, 'html').fail(function(){
		        console.log('arge', arguments)
		    });
			
			$("#cancel").click(function(){
				location = "customers.html";
			});
			$("#loading").hide();
			$("#save_new_cus").click(function(){
				if(!$('#customer-form').valid()){
					return false;
				} 					
				else{
					//alert("submit");
					dataSubmit = $("#customer-form").serialize();
					//$("#test").html(JSON.stringify(dataSubmit));
					$('#loading').show();
					$.ajax({
						url: localStorage.serverUrl + 'mobileservices/control/createNewCustomer',
						crossDomain: true,
						type: 'POST',
						data: dataSubmit,
						dataType: 'json',
						success: function(data){
							//$("#test").html(JSON.stringify(data));
							if(!jQuery.isEmptyObject(data.partyId) && !jQuery.isEmptyObject(data.contactMechId)){
								bootbox.dialog("Đã tạo được khách hàng mới với mã là: " + data.partyId,
										[{
											"label":"Tiếp tục tạo mới",   
											"class" : "btn-small btn-primary",
											"callback": function(){
												location.reload();
											}
										},{
												"label": "Quay lại",
												"class":"btn-small btn-success",
												"callback": function(){
													location = "customers.html";
												}											
										}]);
							}else{
								bootbox.dialog("Chưa tạo được khách hàng! Hãy xem lại!",
												[{
													"label": "OK",
													"class" : "btn-small btn-primary",
													"callback": function(){
														location.reload();
													}
												}]);								
							}
							
						},
						error: function(textStatus, errorThrown){
							
						},
						complete: function(jqXHR, textStatus ){
							$("#loading").hide();
						}
					});
					return true;
				}
			});
			
			$.ajax({ // ajax call starts
				url : localStorage.serverUrl
						+ 'mobileservices/control/getSalesmanRoads', // JQuery loads serverside.php
				crossDomain : true,
				type : "POST",
				dataType : 'json', // Choosing a JSON datatype
				success : function(data) // Variable data contains the data we get from serverside
				{
					localStorage.salesmanRoads = JSON.stringify(data);
					for ( var item in data.roads) {
						$("#road").append(
								new Option(data.roads[item].name,
										data.roads[item].roadId));
					}

					if (localStorage.lastRoad) {
						$("#road").val(localStorage.lastRoad);						
					}

				},
				error : function(textStatus, errorThrown) {

					var roads = JSON.parse(localStorage.salesmanRoads).roads;
					for ( var item in roads) {
						$("#road")
								.append(
										new Option(roads[item].name,
												roads[item].roadId));
					}

					if (localStorage.lastRoad) {
						$("#road").val(localStorage.lastRoad);						
					}
				}
			});
			
			
			
			$('#customer-form').validate({
				errorElement: 'span',
				errorClass: 'help-inline',
				focusInvalid: false,
				errorPlacement: function(error, element) {
					element.html("");
					console.log(element);
				 },
				rules: {					
					groupName: {
						required: true
					},
					address1: {
						required: true						
					},
					postalCode: {
						required: true						
					},
					city:{
						required: true
					}
				},

				messages: {
					groupName: {
						required: "Tên khách hàng không hợp lệ."						
					},
					address1: {
						required: "Địa chỉ không hợp lệ."						
					},
					postalCode: {
						required: "zipcode rỗng"
					},
					city:{
						required: "Giá trị không hợp lệ"
					}
				},

				/* invalidHandler: function (event, validator) { //display error alert on form submit   
					$('.alert-error', $('.login-form')).show();
					console.log(event);
					console.log(validator);
				}, */

				highlight: function (e) {
					$(e).closest('.control-group').removeClass('info').addClass('error');
				},

				success: function (e) {
					$(e).closest('.control-group').removeClass('error').addClass('info');
					$(e).remove();
				},

				errorPlacement: function (error, element) {
					if(element.is(':checkbox') || element.is(':radio')) {
						var controls = element.closest('.controls');
						if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
						else error.insertAfter(element.nextAll('.lbl').eq(0));
					} 
					else if(element.is('.chzn-select')) {
						error.insertAfter(element.nextAll('[class*="chzn-container"]').eq(0));
					}
					else error.insertAfter(element);
				},

				submitHandler: function (form) {
					//alert("submit");
				},
				invalidHandler: function (form, validator) {
					//alert("invalid");
					//console.log(validator);
				}
			});
		});
		</script>		
</body>
</html>	